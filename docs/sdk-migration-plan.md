# Plan: SDK Migration

**Goal:** Replace all data fetching logic that uses the legacy `apiBackendAction` with direct calls to the new, type-safe SDK generated by `@hey-api/openapi-ts`.

**Status File:** `docs/sdk-migration-plan.md`

---

#### Phase 1: Foundational Pages (Get the core user flow working)

-   [x] **Authentication:** `src/pages/Auth.tsx` - *Completed*
    -   Replace `apiBackendAction("auth.login", ...)` with `authService.login(...)`.
    -   Update session checking to use the `useAuth` context.
-   [x] **Main Dashboard:** `src/pages/Index.tsx` - *Completed*
    -   Replace `apiBackendAction("incidentes.list", ...)` with `getIncidentesApiV1IncidentesGet(...)`.
    -   Update `IncidenteSchema` type import to point to `@/generated_sdk/types.gen`.
-   [ ] **Client Management:** `src/pages/mostrador/Clientes.tsx`
    -   Replace `apiBackendAction("clientes.list", ...)` with `listClientesApiV1ClientesGet(...)`.
    -   Update any client-related type imports.
-   [ ] **Client Detail View:** `src/pages/DetalleCliente.tsx`
    -   Replace `apiBackendAction("clientes.get", ...)` with `getClienteApiV1ClientesClienteIdGet(...)`.
    -   Update client and related type imports.

#### Phase 2: Core Incident Workflow

-   [ ] **Incident Detail View:** `src/pages/DetalleIncidente.tsx`
    -   This is a critical page. It likely uses multiple `apiBackendAction` calls for incident details, diagnostics, media, etc.
    -   Replace all `apiBackendAction` calls with their corresponding SDK functions (e.g., `getIncidenteApiV1IncidentesIncidenteIdGet`, `getDiagnosticosIncidenteApiV1IncidentesIncidenteIdDiagnosticosGet`, etc.).
-   [ ] **New Incident Form:** `src/pages/NuevoIncidente.tsx`
    -   Replace `apiBackendAction("clientes.search", ...)` with `listClientesApiV1ClientesGet(...)`.
    -   Replace `apiBackendAction("incidentes.create", ...)` with `createIncidenteApiV1IncidentesPost(...)`.
    -   Update all related type imports.

#### Phase 3: Cleanup and Finalization

-   [ ] **Component-by-Component Sweep:**
    -   Go through all remaining pages and components that still import `apiBackendAction` or types from `@/generated/**`.
    -   Prioritize by user role/section (e.g., `taller`, `logistica`, etc.).
-   [ ] **Remove Legacy Facade:**
    -   Once no files import from `apiBackendAction`, delete `src/lib/api-backend.ts` and `src/lib/api-registry.ts`.
-   [ ] **Remove Old Generated Types:**
    -   Delete the entire `src/generated/**` directory.
-   [ ] **Final Review:**
    -   Run a full project search for `apiBackendAction` and `src/generated/` to ensure no remnants are left.
    -   Run the application and perform a full regression test of all features.
